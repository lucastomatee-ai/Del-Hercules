<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Protocolo Hercules - Prueba Gratuita</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #ef4444; --bg: #050505; --card: #111111; --text: #ffffff; --green: #22c55e; }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg); color: var(--text); min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        
        .container { width: 100%; max-width: 500px; }
        .screen { display: none; }
        .screen.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .card { background: var(--card); border: 1px solid #262626; border-radius: 20px; padding: 25px; box-shadow: 0 20px 40px rgba(0,0,0,0.6); }
        
        .badge { display: inline-block; background: rgba(239,68,68,0.15); border: 1px solid var(--primary); color: var(--primary); padding: 8px 16px; border-radius: 20px; font-size: 11px; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 20px; }
        
        .headline { font-size: 26px; font-weight: 900; color: #fff; margin-bottom: 15px; line-height: 1.2; }
        .subheadline { font-size: 15px; color: #999; margin-bottom: 25px; line-height: 1.4; }
        
        .stats-row { display: flex; gap: 10px; margin-bottom: 25px; }
        .stat-box { flex: 1; background: rgba(34,197,94,0.1); border: 1px solid rgba(34,197,94,0.3); padding: 12px; border-radius: 10px; text-align: center; }
        .stat-number { font-size: 18px; font-weight: 900; color: var(--green); }
        .stat-label { font-size: 10px; color: #999; text-transform: uppercase; margin-top: 4px; }
        
        .urgency-box { background: rgba(239,68,68,0.15); border: 1px solid var(--primary); padding: 12px; border-radius: 10px; text-align: center; margin-bottom: 20px; font-size: 13px; font-weight: 700; color: var(--primary); }
        
        .btn { background: var(--primary); color: white; border: none; padding: 20px; border-radius: 14px; font-weight: 900; cursor: pointer; width: 100%; font-size: 18px; text-transform: uppercase; transition: all 0.3s; box-shadow: 0 10px 20px rgba(239,68,68,0.3); }
        .btn:hover { transform: scale(1.02); }
        
        .progress-bar-container { margin-bottom: 25px; }
        .progress-text { font-size: 12px; font-weight: 900; color: var(--primary); margin-bottom: 8px; text-align: right; }
        .progress-bar { height: 6px; background: #262626; border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s ease; }
        
        .question { font-size: 20px; font-weight: 900; margin-bottom: 20px; line-height: 1.3; }
        .privacy-note { background: rgba(34,197,94,0.1); border: 1px solid rgba(34,197,94,0.3); padding: 12px; border-radius: 10px; margin-bottom: 20px; font-size: 12px; text-align: center; color: var(--green); font-weight: 700; }
        
        .options { display: grid; gap: 12px; }
        .option-btn { background: rgba(255,255,255,0.05); border: 2px solid #262626; color: var(--text); padding: 18px; border-radius: 12px; cursor: pointer; font-weight: 700; transition: all 0.2s; font-size: 16px; text-align: left; }
        .option-btn:hover { border-color: var(--primary); background: rgba(239,68,68,0.1); transform: translateX(5px); }
        
        .analysis-bar { margin-bottom: 15px; }
        .analysis-label { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; font-weight: 700; }
        .bar-container { height: 10px; background: #222; border-radius: 5px; overflow: hidden; }
        .bar-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.5s ease; }
        .bar-fill.complete { background: var(--green); }
        
        .result-box { background: linear-gradient(135deg, rgba(34,197,94,0.2) 0%, rgba(34,197,94,0.05) 100%); border: 2px solid var(--green); padding: 25px; border-radius: 16px; margin: 25px 0; text-align: center; animation: glowPulse 2s infinite; }
        @keyframes glowPulse { 0%,100%{box-shadow:0 0 20px rgba(34,197,94,0.3);} 50%{box-shadow:0 0 40px rgba(34,197,94,0.6);} }
        
        .result-number { font-size: 56px; font-weight: 900; color: var(--green); margin: 15px 0; text-shadow: 0 0 30px rgba(34,197,94,0.6); }
        .result-label { font-size: 14px; color: #ccc; text-transform: uppercase; font-weight: 700; }
        
        .benefit { display: flex; align-items: center; margin-bottom: 15px; font-size: 16px; font-weight: 800; }
        .benefit span { color: var(--green); margin-right: 12px; font-size: 20px; }
        
        .guarantee { background: rgba(34,197,94,0.15); border: 1px solid var(--green); padding: 15px; border-radius: 12px; text-align: center; margin: 20px 0; font-weight: 700; color: var(--green); }
        
        /* Carrusel de reviews estilo Google */
        .testimonials-carousel { position: relative; height: 110px; overflow: hidden; margin: 20px 0; }
        .testimonial-slide { position: absolute; width: 100%; opacity: 0; transition: opacity 0.8s ease; padding: 12px 14px; background: rgba(255,255,255,0.04); border: 1px solid #2a2a2a; border-radius: 14px; }
        .testimonial-slide.active { opacity: 1; }

        .review-row { display: flex; align-items: center; gap: 10px; margin-bottom: 7px; }
        .review-avatar { width: 38px; height: 38px; border-radius: 50%; object-fit: cover; border: 2px solid var(--green); flex-shrink: 0; }
        .review-meta { display: flex; flex-direction: column; }
        .review-name { font-size: 13px; font-weight: 800; color: #fff; line-height: 1.2; }
        .review-stars { color: #facc15; font-size: 12px; letter-spacing: 1px; }
        .review-text { font-size: 13px; color: #ccc; font-weight: 600; line-height: 1.4; padding-left: 48px; }
        
        .security-footer { font-size: 11px; margin-top: 15px; color: #999; font-weight: 700; text-align: center; }
        
        /* Carrusel de resultados */
        .carousel-container { background: rgba(0,255,0,0.05); border: 2px solid rgba(0,255,0,0.3); border-radius: 16px; padding: 25px; margin: 25px 0; }
        .carousel-title { color: #00ff00; font-size: 16px; font-weight: 900; text-align: center; text-transform: uppercase; margin-bottom: 20px; letter-spacing: 1px; }
        .carousel { width: 100%; height: 280px; background: #000; border-radius: 15px; overflow: hidden; position: relative; border: 2px solid #333; }
        .slide { position: absolute; inset: 0; opacity: 0; transition: opacity 0.6s ease; display: flex; align-items: center; justify-content: center; }
        .slide.active { opacity: 1; }
        
        .blurred-container { position: relative; width: 100%; height: 100%; cursor: pointer; overflow: hidden; }
        .blurred-container img { width: 100%; height: 100%; object-fit: contain; filter: blur(20px); transition: all 0.3s; }
        .blurred-container:hover img { filter: blur(15px); transform: scale(1.05); }
        
        .click-overlay { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); transition: opacity 0.3s ease; }
        .blurred-container:hover .click-overlay { background: rgba(0,0,0,0.7); }
        
        .click-icon { font-size: 48px; margin-bottom: 10px; animation: pulseIcon 2s infinite; }
        @keyframes pulseIcon { 0%,100%{transform:scale(1);opacity:0.8;} 50%{transform:scale(1.15);opacity:1;} }
        .click-text { color: #00ff00; font-size: 16px; font-weight: 900; text-transform: uppercase; text-align: center; text-shadow: 0 0 10px rgba(0,255,0,0.5); letter-spacing: 1px; }
        
        .slide-caption { position: absolute; bottom: 15px; left: 15px; right: 15px; background: rgba(0,0,0,0.9); padding: 12px; border-radius: 10px; font-size: 13px; font-weight: 900; color: #00ff00; border: 2px solid rgba(0,255,0,0.5); text-align: center; z-index: 10; text-transform: uppercase; letter-spacing: 0.5px; }
    </style>
</head>
<body>
<div class="container">

    <!-- PANTALLA 1: GANCHO -->
    <div id="screen-1" class="screen active">
        <div class="card">
            <div class="badge" style="display:block;text-align:center;">‚ö° M√âTODO VALIDADO POR +50 MIL HOMBRES</div>
            
            <h1 class="headline" style="text-align:center;">Descubre Cu√°ntos CM Puedes Aumentar en 30 D√≠as</h1>
            <p class="subheadline" style="text-align:center;">Prueba r√°pida basada en ciencia. 100% confidencial.</p>
            
            <div class="stats-row">
                <div class="stat-box">
                    <div class="stat-number">50K+</div>
                    <div class="stat-label">Lo Probaron</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number">4.9‚òÖ</div>
                    <div class="stat-label">Calificaci√≥n</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" style="font-size:13px;line-height:1.3;">ACCESO<br>EXCLUSIVO</div>
                    <div class="stat-label">Solo Hoy</div>
                </div>
            </div>
            
            <div class="privacy-note">üîí TOTALMENTE CONFIDENCIAL ‚Äî Tus respuestas son 100% an√≥nimas</div>
            
            <div class="urgency-box">üî• 1.247 hombres hicieron esta prueba en las √∫ltimas 24 horas</div>
            
            <button class="btn" onclick="startQuiz()">‚ö° DESCUBRIR MI POTENCIAL AHORA</button>
        </div>
    </div>

    <!-- PANTALLA 2: QUIZ (8 PREGUNTAS) -->
    <div id="screen-2" class="screen">
        <div class="card">
            <div class="badge">üîí 100% CONFIDENCIAL</div>
            <div class="progress-bar-container">
                <div class="progress-text" id="progress-text">13% COMPLETO</div>
                <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
            </div>
            <div id="quiz-content"></div>
        </div>
    </div>

    <!-- PANTALLA 3: AN√ÅLISIS -->
    <div id="screen-3" class="screen">
        <div class="card">
            <div class="badge">üî¨ Procesando tus datos</div>
            <h2 class="headline">Analizando Tu Perfil...</h2>
            
            <div class="analysis-bar">
                <div class="analysis-label">
                    <span>Flujo Sangu√≠neo Cavernoso</span>
                    <span id="status-1">‚è≥</span>
                </div>
                <div class="bar-container"><div class="bar-fill" id="bar-1"></div></div>
            </div>
            <div class="analysis-bar">
                <div class="analysis-label">
                    <span>Densidad Tisular</span>
                    <span id="status-2">‚è≥</span>
                </div>
                <div class="bar-container"><div class="bar-fill" id="bar-2"></div></div>
            </div>
            <div class="analysis-bar">
                <div class="analysis-label">
                    <span>Compatibilidad con el Protocolo</span>
                    <span id="status-3">‚è≥</span>
                </div>
                <div class="bar-container"><div class="bar-fill" id="bar-3"></div></div>
            </div>
            
            <!-- TESTIMONIOS DURANTE EL AN√ÅLISIS ‚Äî estilo Google Review -->
            <div id="analysis-testimonials" style="margin-top:20px;position:relative;height:110px;overflow:hidden;">
                <div class="analysis-review active" style="position:absolute;width:100%;opacity:1;transition:opacity 0.8s ease;padding:12px 14px;background:rgba(34,197,94,0.08);border:1px solid rgba(34,197,94,0.3);border-radius:14px;">
                    <div class="review-row">
                        <img class="review-avatar" src="https://randomuser.me/api/portraits/men/32.jpg" alt="Carlos">
                        <div class="review-meta">
                            <span class="review-name">Carlos M., 28 a√±os ‚Äî M√©xico</span>
                            <span class="review-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                        </div>
                    </div>
                    <div class="review-text">"Aument√© 5cm en 45 d√≠as. ¬°Cambi√≥ mi vida por completo!"</div>
                </div>
                <div class="analysis-review" style="position:absolute;width:100%;opacity:0;transition:opacity 0.8s ease;padding:12px 14px;background:rgba(34,197,94,0.08);border:1px solid rgba(34,197,94,0.3);border-radius:14px;">
                    <div class="review-row">
                        <img class="review-avatar" src="https://randomuser.me/api/portraits/men/54.jpg" alt="Miguel">
                        <div class="review-meta">
                            <span class="review-name">Miguel R., 31 a√±os ‚Äî Colombia</span>
                            <span class="review-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                        </div>
                    </div>
                    <div class="review-text">"Mi novia not√≥ la diferencia en apenas 3 semanas."</div>
                </div>
                <div class="analysis-review" style="position:absolute;width:100%;opacity:0;transition:opacity 0.8s ease;padding:12px 14px;background:rgba(34,197,94,0.08);border:1px solid rgba(34,197,94,0.3);border-radius:14px;">
                    <div class="review-row">
                        <img class="review-avatar" src="https://randomuser.me/api/portraits/men/17.jpg" alt="Diego">
                        <div class="review-meta">
                            <span class="review-name">Diego S., 25 a√±os ‚Äî Argentina</span>
                            <span class="review-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                        </div>
                    </div>
                    <div class="review-text">"De 13cm a 18cm. ¬°Un resultado que no esperaba!"</div>
                </div>
                <div class="analysis-review" style="position:absolute;width:100%;opacity:0;transition:opacity 0.8s ease;padding:12px 14px;background:rgba(34,197,94,0.08);border:1px solid rgba(34,197,94,0.3);border-radius:14px;">
                    <div class="review-row">
                        <img class="review-avatar" src="https://randomuser.me/api/portraits/men/44.jpg" alt="Juan">
                        <div class="review-meta">
                            <span class="review-name">Juan P., 29 a√±os ‚Äî Per√∫</span>
                            <span class="review-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                        </div>
                    </div>
                    <div class="review-text">"Consegu√≠ 6cm en 2 meses. ¬°Realmente funciona!"</div>
                </div>
            </div>
            
            <div id="result-container" style="display:none;">
                <div class="result-box">
                    <div class="result-label">üéâ TU POTENCIAL DE CRECIMIENTO:</div>
                    <div class="result-number" id="growth-result">4-6cm</div>
                    <div class="result-label">En hasta 30 d√≠as con el m√©todo</div>
                </div>
                <p style="text-align:center;color:#ccc;font-size:14px;margin-bottom:20px;">
                    Basado en tu perfil, tienes un <strong style="color:var(--green);">potencial ALTO</strong>. ¬°El Protocolo Hercules fue creado exactamente para tu caso!
                </p>
                <button class="btn" onclick="goToOffer()">üöÄ QUIERO ALCANZAR ESTE RESULTADO</button>
            </div>
        </div>
    </div>

    <!-- PANTALLA 4: OFERTA (SIN PRECIO) -->
    <div id="screen-4" class="screen">
        <div class="card">
            <div class="badge" style="display:block;text-align:center;">üî• ACCESO LIBERADO PARA TI</div>
            
            <h1 class="headline" style="text-align:center;font-size:28px;">¬°Transforma Tu Resultado en Realidad!</h1>
            
            <p style="text-align:center;color:#aaa;font-size:15px;margin-bottom:25px;line-height:1.5;">
                Tu perfil fue analizado. El Protocolo Hercules es <strong style="color:var(--green);">100% compatible</strong> con tu caso.
            </p>
            
            <div style="margin:30px 0;">
                <div class="benefit"><span>‚úì</span> Aumento permanente de 3 a 7cm</div>
                <div class="benefit"><span>‚úì</span> Resultados visibles en 30 d√≠as</div>
                <div class="benefit"><span>‚úì</span> Control total de la eyaculaci√≥n</div>
                <div class="benefit"><span>‚úì</span> Sin cirug√≠as ni aparatos</div>
                <div class="benefit"><span>‚úì</span> Aplicaci√≥n exclusiva incluida</div>
            </div>
            
            <!-- CARRUSEL DE RESULTADOS REALES -->
            <div class="carousel-container">
                <div class="carousel-title">üì∏ RESULTADOS REALES VERIFICADOS</div>
                <div id="unlock-message" style="text-align:center;color:#00ff00;font-size:14px;font-weight:900;margin-bottom:15px;animation:pulseIcon 2s infinite;">
                    üëÜ TOCA PARA DESBLOQUEAR LAS 3 FOTOS
                </div>
                <div class="carousel" id="results-carousel">
                    <div class="slide active">
                        <div class="blurred-container" onclick="unlockAllPhotos()">
                            <img class="carousel-img" src="https://i.ibb.co/YFjPy3zS/mea-Saa-Tba-Aaaaamh-D-i-LJzfk9u2-QO-ZC1.jpg" alt="Resultado verificado" style="filter:blur(20px);transition:filter 0.8s ease;">
                            <div class="click-overlay unlock-overlay">
                                <div class="click-icon">üîì</div>
                                <div class="click-text">Toca para desbloquear</div>
                            </div>
                        </div>
                        <div class="slide-caption">PACIENTE M. SOUZA: +5.8cm CONFIRMADO</div>
                    </div>
                    <div class="slide">
                        <div class="blurred-container" onclick="unlockAllPhotos()">
                            <img class="carousel-img" src="https://i.ibb.co/v6cyDsyd/55db78-0079baf30d6c485581fa2291d62c7d25-mv2.avif" alt="Resultado verificado" style="filter:blur(20px);transition:filter 0.8s ease;">
                            <div class="click-overlay unlock-overlay">
                                <div class="click-icon">üîì</div>
                                <div class="click-text">Toca para desbloquear</div>
                            </div>
                        </div>
                        <div class="slide-caption">PACIENTE R. OLIVEIRA: +4.9cm CONFIRMADO</div>
                    </div>
                    <div class="slide">
                        <div class="blurred-container" onclick="unlockAllPhotos()">
                            <img class="carousel-img" src="https://i.ibb.co/JRStgT6L/Whats-App-Image-2024-12-18-at-15-11-46-rcl53qv1p0gr5s3fzr30gvvchnyybvpbhth13gqhj4.jpg" alt="Resultado verificado" style="filter:blur(20px);transition:filter 0.8s ease;">
                            <div class="click-overlay unlock-overlay">
                                <div class="click-icon">üîì</div>
                                <div class="click-text">Toca para desbloquear</div>
                            </div>
                        </div>
                        <div class="slide-caption">PACIENTE L. SANTOS: +6.2cm CONFIRMADO</div>
                    </div>
                </div>
                <div id="unlocked-message" style="display:none;text-align:center;color:#00ff00;font-size:12px;font-weight:700;margin-top:10px;">
                    ‚úÖ FOTOS DESBLOQUEADAS ‚Äî Carrusel en movimiento
                </div>
            </div>
            
            <div class="guarantee" style="font-size:14px;padding:12px;">
                üõ°Ô∏è GARANT√çA INCONDICIONAL DE 30 D√çAS
            </div>
            
            <button class="btn" onclick="checkout()" style="font-size:19px;padding:22px;">
                üöÄ GARANTIZAR MI ACCESO AHORA
            </button>
            
            <div class="testimonials-carousel">
                <div class="testimonial-slide active">
                    <div class="review-row">
                        <img class="review-avatar" src="https://randomuser.me/api/portraits/men/32.jpg" alt="Carlos">
                        <div class="review-meta">
                            <span class="review-name">Carlos M. ¬∑ M√©xico</span>
                            <span class="review-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                        </div>
                    </div>
                    <div class="review-text">"Aument√© 3cm en 6 semanas. ¬°La mejor inversi√≥n que hice!"</div>
                </div>
                <div class="testimonial-slide">
                    <div class="review-row">
                        <img class="review-avatar" src="https://randomuser.me/api/portraits/men/54.jpg" alt="Miguel">
                        <div class="review-meta">
                            <span class="review-name">Miguel R. ¬∑ Colombia</span>
                            <span class="review-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                        </div>
                    </div>
                    <div class="review-text">"Mi novia not√≥ la diferencia en las primeras semanas üî•"</div>
                </div>
                <div class="testimonial-slide">
                    <div class="review-row">
                        <img class="review-avatar" src="https://randomuser.me/api/portraits/men/17.jpg" alt="Diego">
                        <div class="review-meta">
                            <span class="review-name">Diego S. ¬∑ Argentina</span>
                            <span class="review-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                        </div>
                    </div>
                    <div class="review-text">"Ten√≠a 13cm, hoy tengo 16cm. ¬°Cambi√≥ completamente mi autoestima!"</div>
                </div>
                <div class="testimonial-slide">
                    <div class="review-row">
                        <img class="review-avatar" src="https://randomuser.me/api/portraits/men/44.jpg" alt="Juan">
                        <div class="review-meta">
                            <span class="review-name">Juan P. ¬∑ Per√∫</span>
                            <span class="review-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                        </div>
                    </div>
                    <div class="review-text">"Ahora duro lo que YO quiero. ¬°Control total garantizado!"</div>
                </div>
                <div class="testimonial-slide">
                    <div class="review-row">
                        <img class="review-avatar" src="https://randomuser.me/api/portraits/men/68.jpg" alt="Andr√©s">
                        <div class="review-meta">
                            <span class="review-name">Andr√©s V. ¬∑ Chile</span>
                            <span class="review-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                        </div>
                    </div>
                    <div class="review-text">"¬°Funcion√≥! No lo cre√≠a hasta que vi los resultados con mis propios ojos."</div>
                </div>
            </div>
            
            <div class="security-footer">üîí Pago 100% seguro y discreto</div>
        </div>
    </div>

</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, setDoc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const app = initializeApp({
        apiKey: "AIzaSyDk4wUGAeG4uQW7Rmad59AmuzqKiOYB9vk",
        authDomain: "protocolo-hercules.firebaseapp.com",
        projectId: "protocolo-hercules",
        storageBucket: "protocolo-hercules.firebasestorage.app",
        messagingSenderId: "701694377617",
        appId: "1:701694377617:web:153290a4cd66ddaae74930"
    });

    const db = getFirestore(app);
    let sid = localStorage.getItem('alpha_sid');
    if (!sid) {
        sid = 's_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('alpha_sid', sid);
    }

    let userCountry = localStorage.getItem('user_country') || 'OTHER';
    async function detectCountry() {
        try {
            const res = await fetch('https://ipapi.co/json/');
            const data = await res.json();
            userCountry = data.country_code || 'OTHER';
            localStorage.setItem('user_country', userCountry);
        } catch (err) { userCountry = 'OTHER'; }
    }
    detectCountry();

    // QUIZ ‚Äî 8 PREGUNTAS (100% en espa√±ol)
    const QUESTIONS = [
        {
            id: 'tamanho',
            q: 'üìè ¬øCu√°l es el tama√±o de tu pene ERECTO?',
            o: ['Menos de 10cm', 'Entre 10 y 13cm', 'Entre 13 y 16cm', 'M√°s de 16cm'],
            points: [10, 8, 5, 3]
        },
        {
            id: 'duracao',
            q: '‚è±Ô∏è ¬øCu√°nto tiempo duras en la cama?',
            o: ['Menos de 3 minutos', 'Entre 3 y 7 minutos', 'Entre 7 y 15 minutos', 'M√°s de 15 minutos'],
            points: [10, 7, 4, 2]
        },
        {
            id: 'satisfacao',
            q: 'üòî ¬øC√≥mo te sientes con tu desempe√±o sexual?',
            o: ['Muy insatisfecho (ella se queja)', 'Insatisfecho (s√© que puedo mejorar)', 'Aceptable (funciona, pero quiero m√°s)', 'Satisfecho (aunque siempre se puede mejorar)'],
            points: [10, 8, 6, 4]
        },
        {
            id: 'idade',
            q: 'üìÖ ¬øCu√°l es tu edad?',
            o: ['18 a 25 a√±os', '26 a 35 a√±os', '36 a 45 a√±os', '46 a√±os o m√°s'],
            points: [10, 8, 6, 5]
        },
        {
            id: 'alimentacao',
            q: 'üçé ¬øC√≥mo es tu alimentaci√≥n?',
            o: ['Muy saludable', 'Aceptable', 'Mala', 'Muy mala'],
            points: [10, 7, 4, 2]
        },
        {
            id: 'sono',
            q: 'üò¥ ¬øCu√°ntas horas duermes por noche?',
            o: ['7 a 9 horas (buena calidad)', '6 a 7 horas (me despierto cansado)', '5 a 6 horas (duermo poco)', 'Menos de 5 horas'],
            points: [10, 7, 4, 2]
        },
        {
            id: 'tentou',
            q: 'üíä ¬øYa intentaste algo para mejorar tu tama√±o o rendimiento?',
            o: ['S√≠, pero no funcion√≥', 'S√≠, funcion√≥ un poco', 'Nunca intent√© nada', 'Prob√© varias cosas sin √©xito'],
            points: [7, 8, 10, 5]
        },
        {
            id: 'prioridade',
            q: 'üéØ ¬øResolver esto es tu PRIORIDAD m√°xima ahora mismo?',
            o: ['¬°S√≠, es urgente!', 'S√≠, aunque puedo esperar un poco', 'Solo tengo curiosidad', 'No es una prioridad para m√≠'],
            points: [10, 7, 4, 2]
        }
    ];

    let currentQ = 0, answers = {}, totalPoints = 0;

    async function track(e, d = {}) {
        try {
            await updateDoc(doc(db, 'sessions', sid), {
                [`events.${e}`]: serverTimestamp(),
                lastActivity: serverTimestamp(),
                ...d
            });
        } catch (err) {}
    }

    window.startQuiz = function() {
        track('quiz_started');
        showScreen(2);
        renderQuestion();
    };

    function renderQuestion() {
        const q = QUESTIONS[currentQ];
        const progress = ((currentQ + 1) / QUESTIONS.length) * 100;
        document.getElementById('progress-text').innerText = `${Math.round(progress)}% COMPLETO`;
        document.getElementById('progress-fill').style.width = `${progress}%`;
        document.getElementById('quiz-content').innerHTML = `
            <div class="question">${q.q}</div>
            <div class="options">
                ${q.o.map((opt, idx) => `<button class="option-btn" onclick="selectAnswer(${idx}, '${opt.replace(/'/g, "\\'")}')">${opt}</button>`).join('')}
            </div>`;
    }

    window.selectAnswer = function(optionIndex, answer) {
        const q = QUESTIONS[currentQ];
        answers[q.id] = answer;
        totalPoints += q.points[optionIndex];
        const progress = currentQ + 1;
        track('quiz_answer', { question: q.q, answer, quizProgress: progress });
        updateDoc(doc(db, 'sessions', sid), { quizProgress: progress });
        currentQ++;
        if (currentQ < QUESTIONS.length) {
            renderQuestion();
        } else {
            track('quiz_completed', { totalScore: totalPoints });
            showScreen(3);
            startAnalysis();
        }
    };

    function calculateResults() {
        let growth;
        if (totalPoints >= 65) growth = '5‚Äì7cm';
        else if (totalPoints >= 50) growth = '4‚Äì6cm';
        else if (totalPoints >= 35) growth = '3‚Äì5cm';
        else if (totalPoints >= 20) growth = '2‚Äì4cm';
        else growth = '2‚Äì3cm';
        return { growth };
    }

    function startAnalysis() {
        // Carrossel de reviews estilo Google na tela de an√°lise
        const analysisSlides = document.querySelectorAll('.analysis-review');
        let tIdx = 0;
        const tInterval = setInterval(() => {
            analysisSlides[tIdx].style.opacity = '0';
            tIdx = (tIdx + 1) % analysisSlides.length;
            analysisSlides[tIdx].style.opacity = '1';
        }, 2500);

        let step = 0;
        const interval = setInterval(() => {
            step++;
            if (step <= 3) {
                document.getElementById('bar-1').style.width = ((step/3)*100) + '%';
                if (step === 3) {
                    document.getElementById('bar-1').classList.add('complete');
                    document.getElementById('status-1').innerText = '‚úÖ';
                    document.getElementById('status-2').innerText = 'PROCESANDO';
                }
            } else if (step <= 6) {
                document.getElementById('bar-2').style.width = (((step-3)/3)*100) + '%';
                if (step === 6) {
                    document.getElementById('bar-2').classList.add('complete');
                    document.getElementById('status-2').innerText = '‚úÖ';
                    document.getElementById('status-3').innerText = 'PROCESANDO';
                }
            } else if (step <= 8) {
                document.getElementById('bar-3').style.width = (((step-6)/2)*100) + '%';
                if (step === 8) {
                    document.getElementById('bar-3').classList.add('complete');
                    document.getElementById('status-3').innerText = '‚úÖ';
                    clearInterval(interval);
                    clearInterval(tInterval);
                    setTimeout(() => {
                        const results = calculateResults();
                        document.getElementById('growth-result').innerText = results.growth;
                        document.getElementById('analysis-testimonials').style.display = 'none';
                        document.getElementById('result-container').style.display = 'block';
                        track('result_shown', { growthPotential: results.growth, score: totalPoints });
                    }, 300);
                }
            }
        }, 1000);
    }

    window.goToOffer = function() {
        track('offer_viewed');
        showScreen(4);
        startTestimonialsCarousel();
        startResultsCarousel();
    };

    function startTestimonialsCarousel() {
        const slides = document.querySelectorAll('.testimonial-slide');
        let cur = 0;
        setInterval(() => {
            slides[cur].classList.remove('active');
            cur = (cur + 1) % slides.length;
            slides[cur].classList.add('active');
        }, 4000);
    }

    function startResultsCarousel() {
        const slides = document.querySelectorAll('#results-carousel .slide');
        let cur = 0;
        setInterval(() => {
            slides[cur].classList.remove('active');
            cur = (cur + 1) % slides.length;
            slides[cur].classList.add('active');
        }, 2500);
    }

    let photosUnlocked = false;
    window.unlockAllPhotos = function() {
        if (photosUnlocked) return;
        photosUnlocked = true;
        document.querySelectorAll('.carousel-img').forEach((img, i) => {
            setTimeout(() => { img.style.filter = 'blur(0px)'; img.style.transform = 'scale(1.02)'; }, i * 200);
        });
        document.querySelectorAll('.unlock-overlay').forEach((overlay, i) => {
            setTimeout(() => {
                overlay.style.opacity = '0';
                setTimeout(() => overlay.style.display = 'none', 300);
            }, i * 200);
        });
        document.getElementById('unlock-message').style.display = 'none';
        document.getElementById('unlocked-message').style.display = 'block';
        track('all_photos_unlocked', { timestamp: Date.now() });
    };

    window.checkout = function() {
        track('checkout');
        window.location.href = `https://pay.hotmart.com/A101292455I?checkoutMode=10&bid=1771246772174&sck=${sid}`;
    };

    function showScreen(num) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(`screen-${num}`).classList.add('active');
        window.scrollTo(0, 0);
    }

    async function init() {
        try {
            await setDoc(doc(db, 'sessions', sid), {
                sessionId: sid,
                enteredAt: serverTimestamp(),
                lastActivity: serverTimestamp(),
                currentStep: 'hook',
                status: 'active',
                source: 'tiktok_latam',
                country: userCountry,
                quizProgress: 0,
                events: {},
                answers: {},
                conversion: { clickedCheckout: false }
            });
        } catch (err) {}
    }
    init();
</script>
</body>
</html>
